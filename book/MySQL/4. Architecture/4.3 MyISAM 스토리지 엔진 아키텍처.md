# 04. Architecture

# **`4.3 MyISAM 스토리지 엔진 아키텍처`**

![MyISAM구조](/img/MySQL/MyISAM구조.PNG)

<br/>

## **목차**
- [4.3.1 키 캐시](#1)
- [4.3.2 운영체제의 캐시 및 버퍼](#2)
- [4.3.3 데이터 파일과 프라이머리 키(인덱스) 구조](#3)

<br/>

> ## **`4.3.1 키 캐시`**<a id="1"></a>

- 인덱스만 대상으로 하며, 인덱스의 디스크 쓰기 작업에 대해서 부분적으로 버퍼링 역할을 한다.
- InnoDB 버퍼 풀과 비슷한 역할을 한다.

<br/>

> ## **`4.3.2 운영체제의 캐시 및 버퍼`**<a id="2"></a>

- MyISAM 테이블 데이터는 디스크로부터 I/O를 해결해 줄 만한 어떠한 캐시나 버퍼링 기능도 제공하지 않는다. 따라서 MyISAM 테이블의 데이터 읽기나 쓰기 작업은 항상 운영체제의 디스크 읽기 또는 쓰기 작업으로 요청될 수 밖에 없다.
- 대부분의 운영체제는 디스크로 읽기 쓰기에 대한 캐시나 버퍼링 매커니즘을 탑재하므로, MySQL 서버가 요청하는 디스크 읽기 작업을 위해 매번 디스크 파일을 읽지 않는다.
- 운영체제 캐시 기능은 InnoDB 처럼 데이터 특성을 알고 전문적으로 캐시나 버퍼링을 하지는 못한다.

<br/>

- 문제 : 운영체제의 캐시 공간은 남는 메모리를 사용하는 것이 기본원칙이다. 하지만 MySQL 이나 다른 애플리케이션에서 메모리를 모두 사용해 버리면 운영체제가 캐시 용도로 사용할 메모리 공간이 없어진다. 이런 경우 MyISAM 테이블 데이터를 캐시하지 못하여 쿼리 처리가 느려진다.
- 해결 : 데이터베이스에서 MyISAM 테이블을 주로 사용한다면 운영체제가 사용할 수 있는 캐시 공간을 위해 충분한 메로리를 비워둬야 한다.
- MyISAM 이 주로 사용된다면, 일반적으로 키 캐시는 최대 물리 메모리의 40% 이상을 넘지 않고, 나머지 메모리 공간은 운영체제가 자체적인 파일 시스템을 위한 캐시 공간을 마련할 수 있도록 한다.

<br/>

> ## **`4.3.3 데이터 파일과 프라이머리 키(인덱스) 구조`**<a id="3"></a>
- InnoDB와 다르게 MyISAM 테이블은 프라이머리 키에 의한 클러스터링 없이 데이터 파일이 힙 공간처럼 활용된다.
- 즉, 레코드가 프라이머리 키와 무관하게 INSERT 되는 순서대로 데이터 파일에 저장된다.
  
<br/>

- MyISAM 테이블의 레코드는 모두 ROWID라는 물리적인 주솟값을 갖고, 프라이머리 키와 세컨더리 인덱스는 모두 데이터 파일에 저장된 레코드의 ROWID 값을 포인터로 갖는다.

<br/>

- ROWID는 가변 길이와 고정 길이 두 가지 방법으로 저장된다.
- 고정 길이 : 가질 수 있는 레코드 개수가 한정되며, ROWID 값으로 4바이트 정수를 사용한다. 이때, 레코드가 INSERT된 순번이 ROWID로 사용된다.
- 가변 길이 : ROWID는 최대 `myisam_data_porinter_size` 시스템 변수에 설정된 바이트 수만큼의 공간을 사용한다. 첫 번째 바이트는 ROWID 길이를 저장하는 용도로 사용하고 나머지 공간은 실제 ROWID를 저장하는데 사용된다. 이때, 데이터 파일에서 레코드 위치가 ROWID로 사용된다.